### 이미지 캐싱 구현

이 프로젝트에서는 단순한 이미지 캐싱 로직에서 시작하여 개선된 기능을 도입해나갑니다.

아래는 개선 방향과 각 단계별 주요 포인트를 정리한 내용입니다.

##

### 📌 주요 변경 내역

| 커밋 | 설명 |
|------|------|
| #48e15e5 | 큰 이미지를 화면 크기에 맞게 다운샘플링하여 메모리 사용량 절감 및 성능 최적화 |
| #6a37ecd | 동일한 URL 요청이 여러 번 발생할 경우, 첫 요청이 완료될 때까지 기다렸다가 그 결과를 함께 사용하도록 개선 |
| #0b2d1f9 | 메모리 경고(Notification) 발생 시 메모리 캐시 자동 정리로 안정성 강화 |
| #9c41a82 | 현재 사용 중인 캐시 디스크 용량을 계산할 수 있는 메서드 추가 |
| #7f25e1a | **UIImageView**가 이미지 로딩 Task를 직접 관리하도록 개선 (`prepareForReuse` 중복 코드 제거, 취소 누락 방지, Race Condition 개선) |
| #d31b7c0 | 디스크 용량 초과 시 LRU 기반으로 오래된 파일부터 제거하는 최적화 구현 |
| #c62e9ab | `Config`를 통해 캐시 용량, TTL 등 정책을 설정할 수 있도록 확장 |
| #5fae12d | 메모리/디스크 캐시 비우기 및 특정 키의 이미지 제거 로직 추가 |
| #b98c7df | 디스크 저장 방식을 PNG 변환이 아닌 원본 데이터 저장으로 변경 (용량 증가 방지, JPEG 특성 유지) |

##

### 초기 상태
- 메모리/디스크 캐시를 활용한 방식의 캐싱 적용
- 메모리 캐시: `NSCache` 사용 (비워주는 로직 없음)
- 디스크 캐시: `pngData()`로 저장 (만료 정책/용량 제한/삭제 로직 없음)
- 요청 처리: 메모리/캐시에도 없을 시 네트워크를 통해 이미지를 받아오고, 메모리와 디스크에 갱신
- 다운샘플링 적용 X, 이미지 로딩 Task를 셀에서 관리 등의 문제가 있음

##

### 개선 포인트

#### 1. 디스크 캐시 관리
- **만료 정책**
  - 기본적으로 1주일이 지나면 만료 대상으로 간주
- **용량 제한**
  - 무한정 쌓이지 않도록 LRU 방식으로 관리
  - 메타데이터 수정일, 만료 여부 확인 후 정리
- **저장 방식 개선**
  - `pngData()` → 원본 포맷 유지 (JPEG는 JPEG로 저장)
  - 불필요한 용량 증가 및 쓰기 속도 저하 방지

<br>

#### 2. 메모리 캐시 관리
- **용량 및 개수 제한**
  - `countLimit`로 객체 개수 제한
  - `totalCostLimit`으로 전체 메모리의 25% 제한
- **메모리 경고 대응**
  - `UIApplication.didReceiveMemoryWarningNotification` 관찰
  - 경고 시 메모리 캐시 자동 정리

<br>

#### 3. 캐시 삭제 및 관리
- **전체 캐시 비우기**
  - `clearMemoryCache()`, `clearDiskCache()` 제공
  - 로그아웃/설정 화면에서 활용 가능
- **개별 항목 제거**
  - `removeImage(forKey:)` 구현
  - 특정 URL 이미지 삭제 가능 (메모리+디스크 동시 제거)

<br>

#### 4. 동시성 및 중복 요청 처리
- **요청 취소 및 재사용**
  - `loadImage(from:) -> Task<Void, Never>?` 형태 제공
  - UITableView/UICollectionView 셀 재사용 시 이전 요청 자동 취소
  - Kingfisher/SDWebImage처럼 setImage 호출 시 기존 요청 취소 가능
- **중복 다운로드 방지**
  - 동일 URL 다운로드는 1회만 수행
  - 중복 요청 시 기존 다운로드 결과 공유

<br>

#### 5. 대용량 이미지 다운샘플링
- **문제**
  - 작은 UIImageView에도 큰 원본 이미지가 그대로 올라옴
  - 불필요한 메모리 사용 증가
- **개선**
  - Kingfisher `DownsamplingImageProcessor` 참고
  - 요청 시 target size를 지정하여 리사이징된 이미지 생성 및 캐싱
